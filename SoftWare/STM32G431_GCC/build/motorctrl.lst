ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"motorctrl.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.section	.text.motor_enable_noirq,"ax",%progbits
  20              		.align	1
  21              		.syntax unified
  22              		.thumb
  23              		.thumb_func
  25              	motor_enable_noirq:
  26              	.LFB334:
  27              		.file 1 "../BLDCMotor/motorctrl.c"
   1:../BLDCMotor/motorctrl.c **** #include "./motorctrl.h"
   2:../BLDCMotor/motorctrl.c **** #include "debuglog.h"
   3:../BLDCMotor/motorctrl.c **** #include "motorctrl_common.h"
   4:../BLDCMotor/motorctrl.c **** #ifdef BOARD_STM32G431
   5:../BLDCMotor/motorctrl.c **** #include "mt6816.h"
   6:../BLDCMotor/motorctrl.c **** #endif
   7:../BLDCMotor/motorctrl.c **** #define Q15_PI_2                   (51471)
   8:../BLDCMotor/motorctrl.c **** #define Q15_2PI                    (205884)
   9:../BLDCMotor/motorctrl.c **** #define PI_2                       (1.570796f)
  10:../BLDCMotor/motorctrl.c **** #define MOTORCTRL_PERCI            (1)
  11:../BLDCMotor/motorctrl.c **** 
  12:../BLDCMotor/motorctrl.c **** enum{
  13:../BLDCMotor/motorctrl.c ****     MOTOR_INIT,
  14:../BLDCMotor/motorctrl.c ****     MOTOR_IDLE,
  15:../BLDCMotor/motorctrl.c ****     MOTOR_START, 
  16:../BLDCMotor/motorctrl.c ****     MOTOR_RUNING,
  17:../BLDCMotor/motorctrl.c ****     MOTOR_STOP,
  18:../BLDCMotor/motorctrl.c **** };
  19:../BLDCMotor/motorctrl.c **** typedef struct
  20:../BLDCMotor/motorctrl.c **** {
  21:../BLDCMotor/motorctrl.c ****     float ia;
  22:../BLDCMotor/motorctrl.c ****     float ib;
  23:../BLDCMotor/motorctrl.c ****     float ic;
  24:../BLDCMotor/motorctrl.c ****     float ialpha;
  25:../BLDCMotor/motorctrl.c ****     float ibeta;
  26:../BLDCMotor/motorctrl.c ****     float id;
  27:../BLDCMotor/motorctrl.c ****     float iq;
  28:../BLDCMotor/motorctrl.c **** 
  29:../BLDCMotor/motorctrl.c ****     int32_t Q_ia;
  30:../BLDCMotor/motorctrl.c ****     int32_t Q_ib;
  31:../BLDCMotor/motorctrl.c ****     int32_t Q_ic;
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 2


  32:../BLDCMotor/motorctrl.c ****     int32_t Q_ialpha;
  33:../BLDCMotor/motorctrl.c ****     int32_t Q_ibeta;
  34:../BLDCMotor/motorctrl.c ****     int32_t Q_id;
  35:../BLDCMotor/motorctrl.c ****     int32_t Q_iq;
  36:../BLDCMotor/motorctrl.c **** 
  37:../BLDCMotor/motorctrl.c ****     float id_real;
  38:../BLDCMotor/motorctrl.c ****     float iq_targe;
  39:../BLDCMotor/motorctrl.c ****     float iq_real;
  40:../BLDCMotor/motorctrl.c **** 
  41:../BLDCMotor/motorctrl.c ****     float pid_Q_out;
  42:../BLDCMotor/motorctrl.c ****     float pid_D_out;
  43:../BLDCMotor/motorctrl.c ****     float ele_angle;
  44:../BLDCMotor/motorctrl.c ****     float self_ele_theta;
  45:../BLDCMotor/motorctrl.c ****     int32_t Q_ele_angle;
  46:../BLDCMotor/motorctrl.c ****     int32_t Q15_mec_angle;
  47:../BLDCMotor/motorctrl.c **** }motordebug_t;
  48:../BLDCMotor/motorctrl.c **** motordebug_t sg_motordebug = {0};
  49:../BLDCMotor/motorctrl.c **** typedef struct
  50:../BLDCMotor/motorctrl.c **** {
  51:../BLDCMotor/motorctrl.c ****     unsigned char state;
  52:../BLDCMotor/motorctrl.c ****     unsigned short cnt;
  53:../BLDCMotor/motorctrl.c **** }motorctrl_t;
  54:../BLDCMotor/motorctrl.c **** 
  55:../BLDCMotor/motorctrl.c **** static dq_t _currmentloop(abc_t i_abc,float ele_theta);
  56:../BLDCMotor/motorctrl.c **** static float _get_angleoffset(void);
  57:../BLDCMotor/motorctrl.c **** static void motor_enable(void);
  58:../BLDCMotor/motorctrl.c **** static void motor_disable(void);
  59:../BLDCMotor/motorctrl.c **** static void motor_set_pwm(duty_t temp);
  60:../BLDCMotor/motorctrl.c **** 
  61:../BLDCMotor/motorctrl.c **** motorctrl_t g_Motor1 = {
  62:../BLDCMotor/motorctrl.c ****     .state = MOTOR_INIT,
  63:../BLDCMotor/motorctrl.c ****     .cnt = 0,
  64:../BLDCMotor/motorctrl.c **** };
  65:../BLDCMotor/motorctrl.c **** static volatile float sg_MecThetaOffset = 0.0f;
  66:../BLDCMotor/motorctrl.c **** static lowfilter_t sg_elefilter[3];
  67:../BLDCMotor/motorctrl.c **** static pid_cb_t *sgp_curloop_d_pid;
  68:../BLDCMotor/motorctrl.c **** static pid_cb_t *sgp_curloop_q_pid;
  69:../BLDCMotor/motorctrl.c **** static curloop_t sg_curloop_param;
  70:../BLDCMotor/motorctrl.c **** float pre_angle_test = 0.0f;
  71:../BLDCMotor/motorctrl.c **** float next_angle_test = 0.0f;
  72:../BLDCMotor/motorctrl.c **** float raw_angle = 0.0f;
  73:../BLDCMotor/motorctrl.c **** float test_ia = 0.0f;
  74:../BLDCMotor/motorctrl.c **** float test_ib = 0.0f;
  75:../BLDCMotor/motorctrl.c **** float test_ic = 0.0f;
  76:../BLDCMotor/motorctrl.c **** extern float RTT_test_Id;
  77:../BLDCMotor/motorctrl.c **** void motortctrl_process(void)
  78:../BLDCMotor/motorctrl.c **** {
  79:../BLDCMotor/motorctrl.c ****     switch (g_Motor1.state)
  80:../BLDCMotor/motorctrl.c ****     {
  81:../BLDCMotor/motorctrl.c ****     case MOTOR_INIT:
  82:../BLDCMotor/motorctrl.c ****         sg_MecThetaOffset = _get_angleoffset();
  83:../BLDCMotor/motorctrl.c ****         foc_paraminit();
  84:../BLDCMotor/motorctrl.c ****         USER_DEBUG_NORMAL("motor init\r\n");
  85:../BLDCMotor/motorctrl.c ****         HAL_Delay(20);
  86:../BLDCMotor/motorctrl.c ****         motor_enable();
  87:../BLDCMotor/motorctrl.c ****         g_Motor1.state = MOTOR_RUNING;           
  88:../BLDCMotor/motorctrl.c ****         break;
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 3


  89:../BLDCMotor/motorctrl.c **** 
  90:../BLDCMotor/motorctrl.c ****     case MOTOR_RUNING:
  91:../BLDCMotor/motorctrl.c ****         {
  92:../BLDCMotor/motorctrl.c ****             if (!(++g_Motor1.cnt % 15000))
  93:../BLDCMotor/motorctrl.c ****             {
  94:../BLDCMotor/motorctrl.c ****                 // USER_DEBUG_NORMAL("motor 1s\r\n");
  95:../BLDCMotor/motorctrl.c ****                 g_Motor1.state = MOTOR_STOP;
  96:../BLDCMotor/motorctrl.c ****             }
  97:../BLDCMotor/motorctrl.c ****         }
  98:../BLDCMotor/motorctrl.c ****         break;
  99:../BLDCMotor/motorctrl.c **** 
 100:../BLDCMotor/motorctrl.c ****     case MOTOR_STOP:
 101:../BLDCMotor/motorctrl.c ****         motor_disable();
 102:../BLDCMotor/motorctrl.c ****         break;
 103:../BLDCMotor/motorctrl.c ****     default:
 104:../BLDCMotor/motorctrl.c ****         break;
 105:../BLDCMotor/motorctrl.c ****     }
 106:../BLDCMotor/motorctrl.c **** }
 107:../BLDCMotor/motorctrl.c **** /*------------周期性被调用----------------*/
 108:../BLDCMotor/motorctrl.c **** unsigned int test_val = 0;
 109:../BLDCMotor/motorctrl.c **** float cur_angle = 0.0f;
 110:../BLDCMotor/motorctrl.c **** void _50uscycle_process(unsigned int *abc_vale,float _elec_theta)
 111:../BLDCMotor/motorctrl.c **** {
 112:../BLDCMotor/motorctrl.c **** #ifdef BOARD_STM32G431    
 113:../BLDCMotor/motorctrl.c ****     static unsigned int cnt = 0;
 114:../BLDCMotor/motorctrl.c ****     if (cnt++%3000)
 115:../BLDCMotor/motorctrl.c ****     {
 116:../BLDCMotor/motorctrl.c ****         return;
 117:../BLDCMotor/motorctrl.c ****     }
 118:../BLDCMotor/motorctrl.c **** #endif
 119:../BLDCMotor/motorctrl.c ****     test_val = 20;
 120:../BLDCMotor/motorctrl.c **** 
 121:../BLDCMotor/motorctrl.c ****     duty_t dut01,dut02;
 122:../BLDCMotor/motorctrl.c **** /*----------------三相电流处理------------------------------*/    
 123:../BLDCMotor/motorctrl.c ****     float Ia,Ib,Ic;
 124:../BLDCMotor/motorctrl.c ****     int32_t a1,b1,c1;
 125:../BLDCMotor/motorctrl.c ****     a1 = abc_vale[0] - A_ADCCHANNL_OFFSET;
 126:../BLDCMotor/motorctrl.c ****     b1 = abc_vale[1] - B_ADCCHANNL_OFFSET;
 127:../BLDCMotor/motorctrl.c ****     c1 = abc_vale[2] - C_ADCCHANNL_OFFSET;
 128:../BLDCMotor/motorctrl.c ****     sg_motordebug.Q_ia = a1;
 129:../BLDCMotor/motorctrl.c ****     sg_motordebug.Q_ib = b1;
 130:../BLDCMotor/motorctrl.c ****     sg_motordebug.Q_ic = c1;    
 131:../BLDCMotor/motorctrl.c ****     Ia = (float)a1*(float)A_VOLITETOCURRENT_FACTOR;
 132:../BLDCMotor/motorctrl.c ****     Ib = (float)b1*(float)B_VOLITETOCURRENT_FACTOR;
 133:../BLDCMotor/motorctrl.c ****     Ic = (float)c1*(float)C_VOLITETOCURRENT_FACTOR;
 134:../BLDCMotor/motorctrl.c **** #if 1
 135:../BLDCMotor/motorctrl.c ****     abc_t i_abc;
 136:../BLDCMotor/motorctrl.c ****     i_abc.a = lowfilter_cale(&sg_elefilter[0],Ia);
 137:../BLDCMotor/motorctrl.c ****     i_abc.b = lowfilter_cale(&sg_elefilter[1],Ib);
 138:../BLDCMotor/motorctrl.c ****     i_abc.c = lowfilter_cale(&sg_elefilter[2],Ic);
 139:../BLDCMotor/motorctrl.c **** #else
 140:../BLDCMotor/motorctrl.c ****     abc_t i_abc;
 141:../BLDCMotor/motorctrl.c ****     i_abc.a = Ia;
 142:../BLDCMotor/motorctrl.c ****     i_abc.b = Ib;
 143:../BLDCMotor/motorctrl.c ****     i_abc.c = Ic;
 144:../BLDCMotor/motorctrl.c **** #endif
 145:../BLDCMotor/motorctrl.c **** 
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 4


 146:../BLDCMotor/motorctrl.c **** /*---------------------获取当前转子角度-------------------------*/
 147:../BLDCMotor/motorctrl.c **** #ifdef BOARD_STM32H723
 148:../BLDCMotor/motorctrl.c ****     float elec_theta,mech_theta;
 149:../BLDCMotor/motorctrl.c ****     int32_t Q15_Mechtheta;
 150:../BLDCMotor/motorctrl.c ****     Q15_Mechtheta = ((int32_t*)sensor_user_read(SENSOR_01,EN_SENSORDATA_COV))[0];
 151:../BLDCMotor/motorctrl.c ****     mech_theta = _IQ15toF(Q15_Mechtheta);
 152:../BLDCMotor/motorctrl.c ****     raw_angle = mech_theta;
 153:../BLDCMotor/motorctrl.c ****     mech_theta = (mech_theta - sg_MecThetaOffset);
 154:../BLDCMotor/motorctrl.c ****     elec_theta = mech_theta * MOTOR_PAIR;
 155:../BLDCMotor/motorctrl.c ****     elec_theta += ANGLE_COMPENSATA;
 156:../BLDCMotor/motorctrl.c ****     elec_theta = _normalize_angle(elec_theta);
 157:../BLDCMotor/motorctrl.c ****     sg_motordebug.ele_angle = elec_theta;
 158:../BLDCMotor/motorctrl.c ****     // _currmentloop(i_abc,sg_motordebug.self_ele_theta);
 159:../BLDCMotor/motorctrl.c ****     // _currmentloop(elec_theta);
 160:../BLDCMotor/motorctrl.c **** #endif
 161:../BLDCMotor/motorctrl.c **** 
 162:../BLDCMotor/motorctrl.c **** #ifdef BOARD_STM32G431
 163:../BLDCMotor/motorctrl.c **** 
 164:../BLDCMotor/motorctrl.c **** #endif
 165:../BLDCMotor/motorctrl.c **** /*--------------------------------------------------------------
 166:../BLDCMotor/motorctrl.c **** 开环控制
 167:../BLDCMotor/motorctrl.c **** 100us调用匹配参数  
 168:../BLDCMotor/motorctrl.c ****     42BLDC  theta += 0.004f;  uq = 1.0f
 169:../BLDCMotor/motorctrl.c ****     yateng  theta += 0.004f;  uq = 1.0f
 170:../BLDCMotor/motorctrl.c ****     qita    theta += 0.004f;  uq = 1.0f
 171:../BLDCMotor/motorctrl.c **** --------------------------------------------------------------*/
 172:../BLDCMotor/motorctrl.c ****     #if 1//强拖
 173:../BLDCMotor/motorctrl.c ****         {            
 174:../BLDCMotor/motorctrl.c ****             #ifdef BOARD_STM32H723
 175:../BLDCMotor/motorctrl.c ****             dq_t udq = {0.0f,0.8f,_IQ15(0.0f),_IQ15(0.8f)};
 176:../BLDCMotor/motorctrl.c ****             alpbet_t uab,uab_q15;            
 177:../BLDCMotor/motorctrl.c ****             if (sg_motordebug.self_ele_theta > 6.28f)
 178:../BLDCMotor/motorctrl.c ****             {
 179:../BLDCMotor/motorctrl.c ****                 sg_motordebug.self_ele_theta = 0.0f;
 180:../BLDCMotor/motorctrl.c ****             }
 181:../BLDCMotor/motorctrl.c ****             uab = _2r_2s(udq, sg_motordebug.self_ele_theta);
 182:../BLDCMotor/motorctrl.c ****             dut01 = _svpwm(uab.alpha,uab.beta);
 183:../BLDCMotor/motorctrl.c ****             motor_set_pwm(dut01);            
 184:../BLDCMotor/motorctrl.c ****                 sg_motordebug.self_ele_theta += 0.001f;
 185:../BLDCMotor/motorctrl.c ****             #endif
 186:../BLDCMotor/motorctrl.c ****             #ifdef BOARD_STM32G431
 187:../BLDCMotor/motorctrl.c ****                 float elec_theta,mech_theta;
 188:../BLDCMotor/motorctrl.c ****                 int32_t Q15_Mechtheta;
 189:../BLDCMotor/motorctrl.c ****                 Q15_Mechtheta = ((int32_t*)sensor_user_read(SENSOR_01,EN_SENSORDATA_COV))[0];
 190:../BLDCMotor/motorctrl.c ****                 mech_theta = _IQ15toF(Q15_Mechtheta);
 191:../BLDCMotor/motorctrl.c **** 
 192:../BLDCMotor/motorctrl.c ****                 elec_theta = mech_theta * MOTOR_PAIR;
 193:../BLDCMotor/motorctrl.c ****                 elec_theta -= sg_MecThetaOffset;
 194:../BLDCMotor/motorctrl.c **** 
 195:../BLDCMotor/motorctrl.c ****                 elec_theta = _normalize_angle(elec_theta);
 196:../BLDCMotor/motorctrl.c ****                 sg_motordebug.ele_angle = elec_theta;
 197:../BLDCMotor/motorctrl.c ****                 /*方法1*/
 198:../BLDCMotor/motorctrl.c ****                 // mech_theta = mech_theta + _2PI - sg_MecThetaOffset;
 199:../BLDCMotor/motorctrl.c ****                 // elec_theta = mech_theta * 2 - sg_MecThetaOffset/4.0f;
 200:../BLDCMotor/motorctrl.c ****                 // elec_theta = _IQ15toF(_IQ15(elec_theta) % (Q15_2PI));
 201:../BLDCMotor/motorctrl.c ****                 // sg_motordebug.ele_angle = elec_theta;
 202:../BLDCMotor/motorctrl.c **** 
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 5


 203:../BLDCMotor/motorctrl.c ****                 dq_t udq = {0.0f,1.0f,_IQ15(0.0f),_IQ15(0.8f)};
 204:../BLDCMotor/motorctrl.c ****                 alpbet_t uab,uab_q15;
 205:../BLDCMotor/motorctrl.c ****                 if (sg_motordebug.self_ele_theta >= _2PI)
 206:../BLDCMotor/motorctrl.c ****                 {
 207:../BLDCMotor/motorctrl.c ****                     sg_motordebug.self_ele_theta -= _2PI;
 208:../BLDCMotor/motorctrl.c ****                 }
 209:../BLDCMotor/motorctrl.c **** 
 210:../BLDCMotor/motorctrl.c ****                 uab = _2r_2s(udq, sg_motordebug.self_ele_theta);cur_angle = sg_motordebug.self_ele_
 211:../BLDCMotor/motorctrl.c ****                 dut01 = _svpwm(uab.alpha,uab.beta);
 212:../BLDCMotor/motorctrl.c ****                 motor_set_pwm(dut01);
 213:../BLDCMotor/motorctrl.c ****                 sg_motordebug.self_ele_theta += 0.31415926f;
 214:../BLDCMotor/motorctrl.c ****                 // sg_motordebug.self_ele_theta += 0.002f;
 215:../BLDCMotor/motorctrl.c ****             #endif
 216:../BLDCMotor/motorctrl.c ****         }
 217:../BLDCMotor/motorctrl.c ****     #else //使用传感器
 218:../BLDCMotor/motorctrl.c ****     {
 219:../BLDCMotor/motorctrl.c ****         dq_t udq = {0.0f,-1.0f,_IQ15(0.0f),_IQ15(0.8f)};
 220:../BLDCMotor/motorctrl.c ****         alpbet_t uab,uab_q15;
 221:../BLDCMotor/motorctrl.c ****         #if 1/*闭环控制*/
 222:../BLDCMotor/motorctrl.c ****             // udq = _currmentloop(i_abc,elec_theta);
 223:../BLDCMotor/motorctrl.c ****         #endif
 224:../BLDCMotor/motorctrl.c ****         uab = _2r_2s(udq, elec_theta - PI_2);
 225:../BLDCMotor/motorctrl.c ****         dut01 = _svpwm(uab.alpha,uab.beta);
 226:../BLDCMotor/motorctrl.c ****         motor_set_pwm(dut01);
 227:../BLDCMotor/motorctrl.c ****     }
 228:../BLDCMotor/motorctrl.c ****     #endif
 229:../BLDCMotor/motorctrl.c **** 
 230:../BLDCMotor/motorctrl.c ****     return;
 231:../BLDCMotor/motorctrl.c **** }
 232:../BLDCMotor/motorctrl.c **** void _limit_voltagecircle(uint32_t u_ref,uint32_t elec_theta)
 233:../BLDCMotor/motorctrl.c **** {
 234:../BLDCMotor/motorctrl.c ****     uint32_t u_alpha,u_beta;
 235:../BLDCMotor/motorctrl.c ****     u_alpha = u_ref * cosf(elec_theta);
 236:../BLDCMotor/motorctrl.c ****     u_beta = u_ref * sinf(elec_theta);
 237:../BLDCMotor/motorctrl.c **** }
 238:../BLDCMotor/motorctrl.c **** dq_t _currmentloop(abc_t i_abc,float ele_theta)
 239:../BLDCMotor/motorctrl.c **** {
 240:../BLDCMotor/motorctrl.c **** #if 0
 241:../BLDCMotor/motorctrl.c ****     /*--------------对电流进行反Clark变化-----------------------*/
 242:../BLDCMotor/motorctrl.c ****     alpbet_t i_alphbeta;
 243:../BLDCMotor/motorctrl.c ****     dq_t i_dq;
 244:../BLDCMotor/motorctrl.c ****     // i_abc.a = cosf(ele_theta);
 245:../BLDCMotor/motorctrl.c ****     // i_abc.b = cosf(ele_theta - _2PI/3.0f);
 246:../BLDCMotor/motorctrl.c ****     // i_abc.c = cosf(ele_theta + _2PI/3.0f);
 247:../BLDCMotor/motorctrl.c ****     sg_motordebug.ia = i_abc.a;
 248:../BLDCMotor/motorctrl.c ****     sg_motordebug.ib = i_abc.b;
 249:../BLDCMotor/motorctrl.c ****     sg_motordebug.ic = i_abc.c;
 250:../BLDCMotor/motorctrl.c ****     i_abc.Q_a = _IQ15(i_abc.a);
 251:../BLDCMotor/motorctrl.c ****     i_abc.Q_b = _IQ15(i_abc.b);
 252:../BLDCMotor/motorctrl.c ****     i_abc.Q_c = _IQ15(i_abc.c);
 253:../BLDCMotor/motorctrl.c ****     sg_motordebug.Q_ia = i_abc.Q_a;
 254:../BLDCMotor/motorctrl.c ****     sg_motordebug.Q_ib = i_abc.Q_b;
 255:../BLDCMotor/motorctrl.c ****     sg_motordebug.Q_ic = i_abc.Q_c;
 256:../BLDCMotor/motorctrl.c **** 
 257:../BLDCMotor/motorctrl.c ****     _3s_2s_Q(i_abc,&i_alphbeta);
 258:../BLDCMotor/motorctrl.c ****     sg_motordebug.Q_ialpha = i_alphbeta.Q_alpha;
 259:../BLDCMotor/motorctrl.c ****     sg_motordebug.Q_ibeta = i_alphbeta.Q_beta;
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 6


 260:../BLDCMotor/motorctrl.c **** 
 261:../BLDCMotor/motorctrl.c ****     /*-------------对电流进行反Park变换------------------------*/
 262:../BLDCMotor/motorctrl.c ****     _2s_2r_Q(i_alphbeta,(uint32_t)_IQ15((ele_theta - PI/2.0f)),&i_dq);
 263:../BLDCMotor/motorctrl.c ****     sg_motordebug.Q_id = (i_dq.Q_d);
 264:../BLDCMotor/motorctrl.c ****     sg_motordebug.Q_iq = (i_dq.Q_q);
 265:../BLDCMotor/motorctrl.c **** #else
 266:../BLDCMotor/motorctrl.c ****     alpbet_t i_alphbeta;
 267:../BLDCMotor/motorctrl.c ****     dq_t i_dq;
 268:../BLDCMotor/motorctrl.c ****     test_ia = cosf(ele_theta);
 269:../BLDCMotor/motorctrl.c ****     test_ib = cosf(ele_theta - _2PI/3.0f);
 270:../BLDCMotor/motorctrl.c ****     test_ic = cosf(ele_theta + _2PI/3.0f);
 271:../BLDCMotor/motorctrl.c **** 
 272:../BLDCMotor/motorctrl.c ****     // i_abc.a = test_ib;
 273:../BLDCMotor/motorctrl.c ****     // i_abc.b = test_ic;
 274:../BLDCMotor/motorctrl.c ****     // i_abc.c = test_ia;
 275:../BLDCMotor/motorctrl.c **** 
 276:../BLDCMotor/motorctrl.c ****     // i_abc.a = test_ia;
 277:../BLDCMotor/motorctrl.c ****     // i_abc.b = test_ib;
 278:../BLDCMotor/motorctrl.c ****     // i_abc.c = test_ic;
 279:../BLDCMotor/motorctrl.c **** 
 280:../BLDCMotor/motorctrl.c ****     sg_motordebug.ia = i_abc.a;
 281:../BLDCMotor/motorctrl.c ****     sg_motordebug.ib = i_abc.b;
 282:../BLDCMotor/motorctrl.c ****     sg_motordebug.ic = i_abc.c;
 283:../BLDCMotor/motorctrl.c ****     _3s_2s(i_abc,&i_alphbeta);
 284:../BLDCMotor/motorctrl.c ****     sg_motordebug.ialpha = i_alphbeta.alpha;
 285:../BLDCMotor/motorctrl.c ****     sg_motordebug.ibeta = i_alphbeta.beta;    
 286:../BLDCMotor/motorctrl.c ****     _2s_2r(i_alphbeta,((ele_theta)),&i_dq);
 287:../BLDCMotor/motorctrl.c ****     sg_motordebug.id = (i_dq.d);
 288:../BLDCMotor/motorctrl.c ****     sg_motordebug.iq = (i_dq.q);
 289:../BLDCMotor/motorctrl.c **** 
 290:../BLDCMotor/motorctrl.c **** #if 1
 291:../BLDCMotor/motorctrl.c ****     dq_t udq;
 292:../BLDCMotor/motorctrl.c ****     udq.d =pid_contrl(sgp_curloop_d_pid,RTT_test_Id,i_dq.d);
 293:../BLDCMotor/motorctrl.c ****     udq.q = 0.9f;
 294:../BLDCMotor/motorctrl.c **** #endif
 295:../BLDCMotor/motorctrl.c ****     return udq;
 296:../BLDCMotor/motorctrl.c **** #endif
 297:../BLDCMotor/motorctrl.c **** }
 298:../BLDCMotor/motorctrl.c **** 
 299:../BLDCMotor/motorctrl.c **** static void motor_enable(void)
 300:../BLDCMotor/motorctrl.c **** {
 301:../BLDCMotor/motorctrl.c **** #ifdef BOARD_STM32H723
 302:../BLDCMotor/motorctrl.c ****     gpio_setmotor_power();
 303:../BLDCMotor/motorctrl.c **** #endif
 304:../BLDCMotor/motorctrl.c ****     /*pwm 使能*/
 305:../BLDCMotor/motorctrl.c ****     tim_pwm_enable();
 306:../BLDCMotor/motorctrl.c ****     tim_tigger_adc();
 307:../BLDCMotor/motorctrl.c ****     adc_start();
 308:../BLDCMotor/motorctrl.c **** }
 309:../BLDCMotor/motorctrl.c **** static void motor_enable_noirq(void)
 310:../BLDCMotor/motorctrl.c **** {
  28              		.loc 1 310 1 view -0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 0
  31              		@ frame_needed = 0, uses_anonymous_args = 0
  32 0000 08B5     		push	{r3, lr}
  33              	.LCFI0:
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 7


  34              		.cfi_def_cfa_offset 8
  35              		.cfi_offset 3, -8
  36              		.cfi_offset 14, -4
 311:../BLDCMotor/motorctrl.c **** #ifdef BOARD_STM32H723
 312:../BLDCMotor/motorctrl.c ****     gpio_setmotor_power();
 313:../BLDCMotor/motorctrl.c **** #endif    
 314:../BLDCMotor/motorctrl.c ****     /*pwm 使能*/
 315:../BLDCMotor/motorctrl.c ****     tim_pwm_enable();
  37              		.loc 1 315 5 view .LVU1
  38 0002 FFF7FEFF 		bl	tim_pwm_enable
  39              	.LVL0:
 316:../BLDCMotor/motorctrl.c **** }
  40              		.loc 1 316 1 is_stmt 0 view .LVU2
  41 0006 08BD     		pop	{r3, pc}
  42              		.cfi_endproc
  43              	.LFE334:
  45              		.section	.text.motor_set_pwm,"ax",%progbits
  46              		.align	1
  47              		.syntax unified
  48              		.thumb
  49              		.thumb_func
  51              	motor_set_pwm:
  52              	.LFB336:
 317:../BLDCMotor/motorctrl.c **** static void motor_disable(void)
 318:../BLDCMotor/motorctrl.c **** {
 319:../BLDCMotor/motorctrl.c **** #ifdef BOARD_STM32H723
 320:../BLDCMotor/motorctrl.c ****     gpio_setmotor_powerdown();
 321:../BLDCMotor/motorctrl.c **** #endif    
 322:../BLDCMotor/motorctrl.c ****     tim_pwm_disable();
 323:../BLDCMotor/motorctrl.c ****     adc_stop();
 324:../BLDCMotor/motorctrl.c **** }
 325:../BLDCMotor/motorctrl.c **** static void motor_set_pwm(duty_t temp)
 326:../BLDCMotor/motorctrl.c **** {
  53              		.loc 1 326 1 is_stmt 1 view -0
  54              		.cfi_startproc
  55              		@ args = 0, pretend = 0, frame = 16
  56              		@ frame_needed = 0, uses_anonymous_args = 0
  57 0000 00B5     		push	{lr}
  58              	.LCFI1:
  59              		.cfi_def_cfa_offset 4
  60              		.cfi_offset 14, -4
  61 0002 85B0     		sub	sp, sp, #20
  62              	.LCFI2:
  63              		.cfi_def_cfa_offset 24
  64 0004 8DED010A 		vstr.32	s0, [sp, #4]
  65 0008 CDED020A 		vstr.32	s1, [sp, #8]
  66 000c 8DED031A 		vstr.32	s2, [sp, #12]
 327:../BLDCMotor/motorctrl.c ****     tim_set_pwm(temp._a,temp._b,temp._c);
  67              		.loc 1 327 5 view .LVU4
  68 0010 FFF7FEFF 		bl	tim_set_pwm
  69              	.LVL1:
 328:../BLDCMotor/motorctrl.c **** }
  70              		.loc 1 328 1 is_stmt 0 view .LVU5
  71 0014 05B0     		add	sp, sp, #20
  72              	.LCFI3:
  73              		.cfi_def_cfa_offset 4
  74              		@ sp needed
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 8


  75 0016 5DF804FB 		ldr	pc, [sp], #4
  76              		.cfi_endproc
  77              	.LFE336:
  79              		.section	.text.motor_enable,"ax",%progbits
  80              		.align	1
  81              		.syntax unified
  82              		.thumb
  83              		.thumb_func
  85              	motor_enable:
  86              	.LFB333:
 300:../BLDCMotor/motorctrl.c **** #ifdef BOARD_STM32H723
  87              		.loc 1 300 1 is_stmt 1 view -0
  88              		.cfi_startproc
  89              		@ args = 0, pretend = 0, frame = 0
  90              		@ frame_needed = 0, uses_anonymous_args = 0
  91 0000 08B5     		push	{r3, lr}
  92              	.LCFI4:
  93              		.cfi_def_cfa_offset 8
  94              		.cfi_offset 3, -8
  95              		.cfi_offset 14, -4
 305:../BLDCMotor/motorctrl.c ****     tim_tigger_adc();
  96              		.loc 1 305 5 view .LVU7
  97 0002 FFF7FEFF 		bl	tim_pwm_enable
  98              	.LVL2:
 306:../BLDCMotor/motorctrl.c ****     adc_start();
  99              		.loc 1 306 5 view .LVU8
 100 0006 FFF7FEFF 		bl	tim_tigger_adc
 101              	.LVL3:
 307:../BLDCMotor/motorctrl.c **** }
 102              		.loc 1 307 5 view .LVU9
 103 000a FFF7FEFF 		bl	adc_start
 104              	.LVL4:
 308:../BLDCMotor/motorctrl.c **** static void motor_enable_noirq(void)
 105              		.loc 1 308 1 is_stmt 0 view .LVU10
 106 000e 08BD     		pop	{r3, pc}
 107              		.cfi_endproc
 108              	.LFE333:
 110              		.section	.text.motor_disable,"ax",%progbits
 111              		.align	1
 112              		.syntax unified
 113              		.thumb
 114              		.thumb_func
 116              	motor_disable:
 117              	.LFB335:
 318:../BLDCMotor/motorctrl.c **** #ifdef BOARD_STM32H723
 118              		.loc 1 318 1 is_stmt 1 view -0
 119              		.cfi_startproc
 120              		@ args = 0, pretend = 0, frame = 0
 121              		@ frame_needed = 0, uses_anonymous_args = 0
 122 0000 08B5     		push	{r3, lr}
 123              	.LCFI5:
 124              		.cfi_def_cfa_offset 8
 125              		.cfi_offset 3, -8
 126              		.cfi_offset 14, -4
 322:../BLDCMotor/motorctrl.c ****     adc_stop();
 127              		.loc 1 322 5 view .LVU12
 128 0002 FFF7FEFF 		bl	tim_pwm_disable
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 9


 129              	.LVL5:
 323:../BLDCMotor/motorctrl.c **** }
 130              		.loc 1 323 5 view .LVU13
 131 0006 FFF7FEFF 		bl	adc_stop
 132              	.LVL6:
 324:../BLDCMotor/motorctrl.c **** static void motor_set_pwm(duty_t temp)
 133              		.loc 1 324 1 is_stmt 0 view .LVU14
 134 000a 08BD     		pop	{r3, pc}
 135              		.cfi_endproc
 136              	.LFE335:
 138              		.section	.text._get_angleoffset,"ax",%progbits
 139              		.align	1
 140              		.syntax unified
 141              		.thumb
 142              		.thumb_func
 144              	_get_angleoffset:
 145              	.LFB337:
 329:../BLDCMotor/motorctrl.c **** static float _get_angleoffset(void)
 330:../BLDCMotor/motorctrl.c **** {
 146              		.loc 1 330 1 is_stmt 1 view -0
 147              		.cfi_startproc
 148              		@ args = 0, pretend = 0, frame = 32
 149              		@ frame_needed = 0, uses_anonymous_args = 0
 150 0000 30B5     		push	{r4, r5, lr}
 151              	.LCFI6:
 152              		.cfi_def_cfa_offset 12
 153              		.cfi_offset 4, -12
 154              		.cfi_offset 5, -8
 155              		.cfi_offset 14, -4
 156 0002 89B0     		sub	sp, sp, #36
 157              	.LCFI7:
 158              		.cfi_def_cfa_offset 48
 331:../BLDCMotor/motorctrl.c ****     motor_enable_noirq();
 159              		.loc 1 331 5 view .LVU16
 160 0004 FFF7FEFF 		bl	motor_enable_noirq
 161              	.LVL7:
 332:../BLDCMotor/motorctrl.c ****     /*-----------设置alpha/beta坐标系------------------*/
 333:../BLDCMotor/motorctrl.c ****     alpbet_t uab = {1.0f,0.0f};
 162              		.loc 1 333 5 view .LVU17
 163              		.loc 1 333 14 is_stmt 0 view .LVU18
 164 0008 0025     		movs	r5, #0
 165 000a 0495     		str	r5, [sp, #16]
 166 000c 0595     		str	r5, [sp, #20]
 167 000e 0695     		str	r5, [sp, #24]
 168 0010 0795     		str	r5, [sp, #28]
 169 0012 B7EE000A 		vmov.f32	s0, #1.0e+0
 170 0016 8DED040A 		vstr.32	s0, [sp, #16]
 334:../BLDCMotor/motorctrl.c ****     duty_t dut01;
 171              		.loc 1 334 5 is_stmt 1 view .LVU19
 335:../BLDCMotor/motorctrl.c ****     float theta;
 172              		.loc 1 335 5 view .LVU20
 336:../BLDCMotor/motorctrl.c ****     dut01 = _svpwm(uab.alpha,uab.beta);
 173              		.loc 1 336 5 view .LVU21
 174              		.loc 1 336 13 is_stmt 0 view .LVU22
 175 001a DFED140A 		vldr.32	s1, .L13
 176 001e FFF7FEFF 		bl	_svpwm
 177              	.LVL8:
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 10


 178 0022 8DED010A 		vstr.32	s0, [sp, #4]
 179 0026 CDED020A 		vstr.32	s1, [sp, #8]
 180 002a 8DED031A 		vstr.32	s2, [sp, #12]
 337:../BLDCMotor/motorctrl.c ****     motor_set_pwm(dut01);
 181              		.loc 1 337 5 is_stmt 1 view .LVU23
 182 002e FFF7FEFF 		bl	motor_set_pwm
 183              	.LVL9:
 338:../BLDCMotor/motorctrl.c ****     HAL_Delay(500);
 184              		.loc 1 338 5 view .LVU24
 185 0032 4FF4FA70 		mov	r0, #500
 186 0036 FFF7FEFF 		bl	HAL_Delay
 187              	.LVL10:
 339:../BLDCMotor/motorctrl.c ****     #ifdef BOARD_STM32H723
 340:../BLDCMotor/motorctrl.c ****         tim_encode_writecnt(0);
 341:../BLDCMotor/motorctrl.c ****         theta = 0.0f;
 342:../BLDCMotor/motorctrl.c ****         motor_disable();
 343:../BLDCMotor/motorctrl.c ****         return theta;
 344:../BLDCMotor/motorctrl.c ****     #endif
 345:../BLDCMotor/motorctrl.c **** 
 346:../BLDCMotor/motorctrl.c ****     #ifdef BOARD_STM32G431
 347:../BLDCMotor/motorctrl.c ****         motor_disable();
 188              		.loc 1 347 9 view .LVU25
 189 003a FFF7FEFF 		bl	motor_disable
 190              	.LVL11:
 348:../BLDCMotor/motorctrl.c ****         int32_t Q15_theta;
 191              		.loc 1 348 9 view .LVU26
 349:../BLDCMotor/motorctrl.c ****         int32_t Q_thetaSum = 0;
 192              		.loc 1 349 9 view .LVU27
 350:../BLDCMotor/motorctrl.c ****         for (uint8_t i = 0; i < 10; i++)
 193              		.loc 1 350 9 view .LVU28
 194              	.LBB2:
 195              		.loc 1 350 14 view .LVU29
 196              		.loc 1 350 22 is_stmt 0 view .LVU30
 197 003e 2C46     		mov	r4, r5
 198              		.loc 1 350 9 view .LVU31
 199 0040 07E0     		b	.L10
 200              	.LVL12:
 201              	.L11:
 351:../BLDCMotor/motorctrl.c ****         {
 352:../BLDCMotor/motorctrl.c ****             Q_thetaSum += ((int32_t*)(sensor_user_read(SENSOR_01,EN_SENSORDATA_COV)))[0];
 202              		.loc 1 352 13 is_stmt 1 discriminator 3 view .LVU32
 203              		.loc 1 352 39 is_stmt 0 discriminator 3 view .LVU33
 204 0042 0121     		movs	r1, #1
 205 0044 0020     		movs	r0, #0
 206 0046 FFF7FEFF 		bl	sensor_user_read
 207              	.LVL13:
 208              		.loc 1 352 86 discriminator 3 view .LVU34
 209 004a 0368     		ldr	r3, [r0]
 210              		.loc 1 352 24 discriminator 3 view .LVU35
 211 004c 1D44     		add	r5, r5, r3
 212              	.LVL14:
 350:../BLDCMotor/motorctrl.c ****         for (uint8_t i = 0; i < 10; i++)
 213              		.loc 1 350 37 is_stmt 1 discriminator 3 view .LVU36
 350:../BLDCMotor/motorctrl.c ****         for (uint8_t i = 0; i < 10; i++)
 214              		.loc 1 350 38 is_stmt 0 discriminator 3 view .LVU37
 215 004e 0134     		adds	r4, r4, #1
 216              	.LVL15:
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 11


 350:../BLDCMotor/motorctrl.c ****         for (uint8_t i = 0; i < 10; i++)
 217              		.loc 1 350 38 discriminator 3 view .LVU38
 218 0050 E4B2     		uxtb	r4, r4
 219              	.LVL16:
 220              	.L10:
 350:../BLDCMotor/motorctrl.c ****         for (uint8_t i = 0; i < 10; i++)
 221              		.loc 1 350 29 is_stmt 1 discriminator 1 view .LVU39
 350:../BLDCMotor/motorctrl.c ****         for (uint8_t i = 0; i < 10; i++)
 222              		.loc 1 350 9 is_stmt 0 discriminator 1 view .LVU40
 223 0052 092C     		cmp	r4, #9
 224 0054 F5D9     		bls	.L11
 225              	.LBE2:
 353:../BLDCMotor/motorctrl.c ****         }
 354:../BLDCMotor/motorctrl.c ****         Q15_theta = Q_thetaSum/10;        
 226              		.loc 1 354 9 is_stmt 1 view .LVU41
 227              		.loc 1 354 19 is_stmt 0 view .LVU42
 228 0056 0648     		ldr	r0, .L13+4
 229 0058 80FB0530 		smull	r3, r0, r0, r5
 230 005c ED17     		asrs	r5, r5, #31
 231              	.LVL17:
 355:../BLDCMotor/motorctrl.c ****         theta = _IQ15toF(Q15_theta);
 232              		.loc 1 355 9 is_stmt 1 view .LVU43
 233              		.loc 1 355 17 is_stmt 0 view .LVU44
 234 005e C5EBA000 		rsb	r0, r5, r0, asr #2
 235              	.LVL18:
 236              		.loc 1 355 17 view .LVU45
 237 0062 FFF7FEFF 		bl	_IQ15toF
 238              	.LVL19:
 356:../BLDCMotor/motorctrl.c ****         return theta;
 239              		.loc 1 356 9 is_stmt 1 view .LVU46
 357:../BLDCMotor/motorctrl.c ****     #endif
 358:../BLDCMotor/motorctrl.c **** }
 240              		.loc 1 358 1 is_stmt 0 view .LVU47
 241 0066 09B0     		add	sp, sp, #36
 242              	.LCFI8:
 243              		.cfi_def_cfa_offset 12
 244              		@ sp needed
 245 0068 30BD     		pop	{r4, r5, pc}
 246              	.LVL20:
 247              	.L14:
 248              		.loc 1 358 1 view .LVU48
 249 006a 00BF     		.align	2
 250              	.L13:
 251 006c 00000000 		.word	0
 252 0070 67666666 		.word	1717986919
 253              		.cfi_endproc
 254              	.LFE337:
 256              		.section	.text._50uscycle_process,"ax",%progbits
 257              		.align	1
 258              		.global	_50uscycle_process
 259              		.syntax unified
 260              		.thumb
 261              		.thumb_func
 263              	_50uscycle_process:
 264              	.LVL21:
 265              	.LFB330:
 111:../BLDCMotor/motorctrl.c **** #ifdef BOARD_STM32G431    
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 12


 266              		.loc 1 111 1 is_stmt 1 view -0
 267              		.cfi_startproc
 268              		@ args = 0, pretend = 0, frame = 72
 269              		@ frame_needed = 0, uses_anonymous_args = 0
 113:../BLDCMotor/motorctrl.c ****     if (cnt++%3000)
 270              		.loc 1 113 5 view .LVU50
 114:../BLDCMotor/motorctrl.c ****     {
 271              		.loc 1 114 5 view .LVU51
 114:../BLDCMotor/motorctrl.c ****     {
 272              		.loc 1 114 12 is_stmt 0 view .LVU52
 273 0000 4D4B     		ldr	r3, .L25
 274 0002 1A68     		ldr	r2, [r3]
 275 0004 511C     		adds	r1, r2, #1
 276 0006 1960     		str	r1, [r3]
 114:../BLDCMotor/motorctrl.c ****     {
 277              		.loc 1 114 14 view .LVU53
 278 0008 4C4B     		ldr	r3, .L25+4
 279 000a A3FB0213 		umull	r1, r3, r3, r2
 280 000e 9B09     		lsrs	r3, r3, #6
 281 0010 40F6B831 		movw	r1, #3000
 282 0014 01FB1323 		mls	r3, r1, r3, r2
 114:../BLDCMotor/motorctrl.c ****     {
 283              		.loc 1 114 8 view .LVU54
 284 0018 03B1     		cbz	r3, .L24
 285 001a 7047     		bx	lr
 286              	.L24:
 111:../BLDCMotor/motorctrl.c **** #ifdef BOARD_STM32G431    
 287              		.loc 1 111 1 view .LVU55
 288 001c 30B5     		push	{r4, r5, lr}
 289              	.LCFI9:
 290              		.cfi_def_cfa_offset 12
 291              		.cfi_offset 4, -12
 292              		.cfi_offset 5, -8
 293              		.cfi_offset 14, -4
 294 001e 2DED028B 		vpush.64	{d8}
 295              	.LCFI10:
 296              		.cfi_def_cfa_offset 20
 297              		.cfi_offset 80, -20
 298              		.cfi_offset 81, -16
 299 0022 95B0     		sub	sp, sp, #84
 300              	.LCFI11:
 301              		.cfi_def_cfa_offset 104
 119:../BLDCMotor/motorctrl.c **** 
 302              		.loc 1 119 5 is_stmt 1 view .LVU56
 119:../BLDCMotor/motorctrl.c **** 
 303              		.loc 1 119 14 is_stmt 0 view .LVU57
 304 0024 464B     		ldr	r3, .L25+8
 305 0026 1422     		movs	r2, #20
 306 0028 1A60     		str	r2, [r3]
 121:../BLDCMotor/motorctrl.c **** /*----------------三相电流处理------------------------------*/    
 307              		.loc 1 121 5 is_stmt 1 view .LVU58
 123:../BLDCMotor/motorctrl.c ****     int32_t a1,b1,c1;
 308              		.loc 1 123 5 view .LVU59
 124:../BLDCMotor/motorctrl.c ****     a1 = abc_vale[0] - A_ADCCHANNL_OFFSET;
 309              		.loc 1 124 5 view .LVU60
 125:../BLDCMotor/motorctrl.c ****     b1 = abc_vale[1] - B_ADCCHANNL_OFFSET;
 310              		.loc 1 125 5 view .LVU61
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 13


 125:../BLDCMotor/motorctrl.c ****     b1 = abc_vale[1] - B_ADCCHANNL_OFFSET;
 311              		.loc 1 125 18 is_stmt 0 view .LVU62
 312 002a 0168     		ldr	r1, [r0]
 125:../BLDCMotor/motorctrl.c ****     b1 = abc_vale[1] - B_ADCCHANNL_OFFSET;
 313              		.loc 1 125 22 view .LVU63
 314 002c A1F63401 		subw	r1, r1, #2100
 315              	.LVL22:
 126:../BLDCMotor/motorctrl.c ****     c1 = abc_vale[2] - C_ADCCHANNL_OFFSET;
 316              		.loc 1 126 5 is_stmt 1 view .LVU64
 126:../BLDCMotor/motorctrl.c ****     c1 = abc_vale[2] - C_ADCCHANNL_OFFSET;
 317              		.loc 1 126 18 is_stmt 0 view .LVU65
 318 0030 4268     		ldr	r2, [r0, #4]
 126:../BLDCMotor/motorctrl.c ****     c1 = abc_vale[2] - C_ADCCHANNL_OFFSET;
 319              		.loc 1 126 22 view .LVU66
 320 0032 A2F66602 		subw	r2, r2, #2150
 321              	.LVL23:
 127:../BLDCMotor/motorctrl.c ****     sg_motordebug.Q_ia = a1;
 322              		.loc 1 127 5 is_stmt 1 view .LVU67
 127:../BLDCMotor/motorctrl.c ****     sg_motordebug.Q_ia = a1;
 323              		.loc 1 127 18 is_stmt 0 view .LVU68
 324 0036 8368     		ldr	r3, [r0, #8]
 127:../BLDCMotor/motorctrl.c ****     sg_motordebug.Q_ia = a1;
 325              		.loc 1 127 22 view .LVU69
 326 0038 A3F66603 		subw	r3, r3, #2150
 327              	.LVL24:
 128:../BLDCMotor/motorctrl.c ****     sg_motordebug.Q_ib = b1;
 328              		.loc 1 128 5 is_stmt 1 view .LVU70
 128:../BLDCMotor/motorctrl.c ****     sg_motordebug.Q_ib = b1;
 329              		.loc 1 128 24 is_stmt 0 view .LVU71
 330 003c 414C     		ldr	r4, .L25+12
 331 003e E161     		str	r1, [r4, #28]
 129:../BLDCMotor/motorctrl.c ****     sg_motordebug.Q_ic = c1;    
 332              		.loc 1 129 5 is_stmt 1 view .LVU72
 129:../BLDCMotor/motorctrl.c ****     sg_motordebug.Q_ic = c1;    
 333              		.loc 1 129 24 is_stmt 0 view .LVU73
 334 0040 2262     		str	r2, [r4, #32]
 130:../BLDCMotor/motorctrl.c ****     Ia = (float)a1*(float)A_VOLITETOCURRENT_FACTOR;
 335              		.loc 1 130 5 is_stmt 1 view .LVU74
 130:../BLDCMotor/motorctrl.c ****     Ia = (float)a1*(float)A_VOLITETOCURRENT_FACTOR;
 336              		.loc 1 130 24 is_stmt 0 view .LVU75
 337 0042 6362     		str	r3, [r4, #36]
 131:../BLDCMotor/motorctrl.c ****     Ib = (float)b1*(float)B_VOLITETOCURRENT_FACTOR;
 338              		.loc 1 131 5 is_stmt 1 view .LVU76
 131:../BLDCMotor/motorctrl.c ****     Ib = (float)b1*(float)B_VOLITETOCURRENT_FACTOR;
 339              		.loc 1 131 10 is_stmt 0 view .LVU77
 340 0044 07EE901A 		vmov	s15, r1	@ int
 341 0048 B8EEE70A 		vcvt.f32.s32	s0, s15
 342              	.LVL25:
 132:../BLDCMotor/motorctrl.c ****     Ic = (float)c1*(float)C_VOLITETOCURRENT_FACTOR;
 343              		.loc 1 132 5 is_stmt 1 view .LVU78
 132:../BLDCMotor/motorctrl.c ****     Ic = (float)c1*(float)C_VOLITETOCURRENT_FACTOR;
 344              		.loc 1 132 10 is_stmt 0 view .LVU79
 345 004c 07EE902A 		vmov	s15, r2	@ int
 346 0050 F8EEE78A 		vcvt.f32.s32	s17, s15
 132:../BLDCMotor/motorctrl.c ****     Ic = (float)c1*(float)C_VOLITETOCURRENT_FACTOR;
 347              		.loc 1 132 8 view .LVU80
 348 0054 DFED3C7A 		vldr.32	s15, .L25+16
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 14


 349 0058 68EEA78A 		vmul.f32	s17, s17, s15
 350              	.LVL26:
 133:../BLDCMotor/motorctrl.c **** #if 1
 351              		.loc 1 133 5 is_stmt 1 view .LVU81
 133:../BLDCMotor/motorctrl.c **** #if 1
 352              		.loc 1 133 10 is_stmt 0 view .LVU82
 353 005c 07EE903A 		vmov	s15, r3	@ int
 354 0060 B8EEE78A 		vcvt.f32.s32	s16, s15
 133:../BLDCMotor/motorctrl.c **** #if 1
 355              		.loc 1 133 8 view .LVU83
 356 0064 DFED397A 		vldr.32	s15, .L25+20
 357 0068 28EE278A 		vmul.f32	s16, s16, s15
 358              	.LVL27:
 135:../BLDCMotor/motorctrl.c ****     i_abc.a = lowfilter_cale(&sg_elefilter[0],Ia);
 359              		.loc 1 135 5 is_stmt 1 view .LVU84
 136:../BLDCMotor/motorctrl.c ****     i_abc.b = lowfilter_cale(&sg_elefilter[1],Ib);
 360              		.loc 1 136 5 view .LVU85
 136:../BLDCMotor/motorctrl.c ****     i_abc.b = lowfilter_cale(&sg_elefilter[1],Ib);
 361              		.loc 1 136 15 is_stmt 0 view .LVU86
 362 006c 384D     		ldr	r5, .L25+24
 363 006e DFED397A 		vldr.32	s15, .L25+28
 364 0072 20EE270A 		vmul.f32	s0, s0, s15
 365              	.LVL28:
 136:../BLDCMotor/motorctrl.c ****     i_abc.b = lowfilter_cale(&sg_elefilter[1],Ib);
 366              		.loc 1 136 15 view .LVU87
 367 0076 2846     		mov	r0, r5
 368              	.LVL29:
 136:../BLDCMotor/motorctrl.c ****     i_abc.b = lowfilter_cale(&sg_elefilter[1],Ib);
 369              		.loc 1 136 15 view .LVU88
 370 0078 FFF7FEFF 		bl	lowfilter_cale
 371              	.LVL30:
 136:../BLDCMotor/motorctrl.c ****     i_abc.b = lowfilter_cale(&sg_elefilter[1],Ib);
 372              		.loc 1 136 13 view .LVU89
 373 007c 8DED0B0A 		vstr.32	s0, [sp, #44]
 137:../BLDCMotor/motorctrl.c ****     i_abc.c = lowfilter_cale(&sg_elefilter[2],Ic);
 374              		.loc 1 137 5 is_stmt 1 view .LVU90
 137:../BLDCMotor/motorctrl.c ****     i_abc.c = lowfilter_cale(&sg_elefilter[2],Ic);
 375              		.loc 1 137 15 is_stmt 0 view .LVU91
 376 0080 B0EE680A 		vmov.f32	s0, s17
 377 0084 05F10800 		add	r0, r5, #8
 378 0088 FFF7FEFF 		bl	lowfilter_cale
 379              	.LVL31:
 137:../BLDCMotor/motorctrl.c ****     i_abc.c = lowfilter_cale(&sg_elefilter[2],Ic);
 380              		.loc 1 137 13 view .LVU92
 381 008c 8DED0C0A 		vstr.32	s0, [sp, #48]
 138:../BLDCMotor/motorctrl.c **** #else
 382              		.loc 1 138 5 is_stmt 1 view .LVU93
 138:../BLDCMotor/motorctrl.c **** #else
 383              		.loc 1 138 15 is_stmt 0 view .LVU94
 384 0090 B0EE480A 		vmov.f32	s0, s16
 385 0094 05F11000 		add	r0, r5, #16
 386 0098 FFF7FEFF 		bl	lowfilter_cale
 387              	.LVL32:
 138:../BLDCMotor/motorctrl.c **** #else
 388              		.loc 1 138 13 view .LVU95
 389 009c 8DED0D0A 		vstr.32	s0, [sp, #52]
 390              	.LBB3:
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 15


 187:../BLDCMotor/motorctrl.c ****                 int32_t Q15_Mechtheta;
 391              		.loc 1 187 17 is_stmt 1 view .LVU96
 188:../BLDCMotor/motorctrl.c ****                 Q15_Mechtheta = ((int32_t*)sensor_user_read(SENSOR_01,EN_SENSORDATA_COV))[0];
 392              		.loc 1 188 17 view .LVU97
 189:../BLDCMotor/motorctrl.c ****                 mech_theta = _IQ15toF(Q15_Mechtheta);
 393              		.loc 1 189 17 view .LVU98
 189:../BLDCMotor/motorctrl.c ****                 mech_theta = _IQ15toF(Q15_Mechtheta);
 394              		.loc 1 189 44 is_stmt 0 view .LVU99
 395 00a0 0121     		movs	r1, #1
 396 00a2 0020     		movs	r0, #0
 397 00a4 FFF7FEFF 		bl	sensor_user_read
 398              	.LVL33:
 190:../BLDCMotor/motorctrl.c **** 
 399              		.loc 1 190 17 is_stmt 1 view .LVU100
 190:../BLDCMotor/motorctrl.c **** 
 400              		.loc 1 190 30 is_stmt 0 view .LVU101
 401 00a8 0068     		ldr	r0, [r0]
 402              	.LVL34:
 190:../BLDCMotor/motorctrl.c **** 
 403              		.loc 1 190 30 view .LVU102
 404 00aa FFF7FEFF 		bl	_IQ15toF
 405              	.LVL35:
 192:../BLDCMotor/motorctrl.c ****                 elec_theta -= sg_MecThetaOffset;
 406              		.loc 1 192 17 is_stmt 1 view .LVU103
 192:../BLDCMotor/motorctrl.c ****                 elec_theta -= sg_MecThetaOffset;
 407              		.loc 1 192 28 is_stmt 0 view .LVU104
 408 00ae 30EE000A 		vadd.f32	s0, s0, s0
 409              	.LVL36:
 193:../BLDCMotor/motorctrl.c **** 
 410              		.loc 1 193 17 is_stmt 1 view .LVU105
 411 00b2 294B     		ldr	r3, .L25+32
 412 00b4 D3ED007A 		vldr.32	s15, [r3]
 413              	.LVL37:
 195:../BLDCMotor/motorctrl.c ****                 sg_motordebug.ele_angle = elec_theta;
 414              		.loc 1 195 17 view .LVU106
 195:../BLDCMotor/motorctrl.c ****                 sg_motordebug.ele_angle = elec_theta;
 415              		.loc 1 195 30 is_stmt 0 view .LVU107
 416 00b8 30EE670A 		vsub.f32	s0, s0, s15
 417              	.LVL38:
 195:../BLDCMotor/motorctrl.c ****                 sg_motordebug.ele_angle = elec_theta;
 418              		.loc 1 195 30 view .LVU108
 419 00bc FFF7FEFF 		bl	_normalize_angle
 420              	.LVL39:
 196:../BLDCMotor/motorctrl.c ****                 /*方法1*/
 421              		.loc 1 196 17 is_stmt 1 view .LVU109
 196:../BLDCMotor/motorctrl.c ****                 /*方法1*/
 422              		.loc 1 196 41 is_stmt 0 view .LVU110
 423 00c0 84ED130A 		vstr.32	s0, [r4, #76]
 203:../BLDCMotor/motorctrl.c ****                 alpbet_t uab,uab_q15;
 424              		.loc 1 203 17 is_stmt 1 view .LVU111
 203:../BLDCMotor/motorctrl.c ****                 alpbet_t uab,uab_q15;
 425              		.loc 1 203 22 is_stmt 0 view .LVU112
 426 00c4 254B     		ldr	r3, .L25+36
 427 00c6 0DF10C0C 		add	ip, sp, #12
 428 00ca 0FCB     		ldm	r3, {r0, r1, r2, r3}
 429 00cc 8CE80F00 		stm	ip, {r0, r1, r2, r3}
 204:../BLDCMotor/motorctrl.c ****                 if (sg_motordebug.self_ele_theta >= _2PI)
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 16


 430              		.loc 1 204 17 is_stmt 1 view .LVU113
 205:../BLDCMotor/motorctrl.c ****                 {
 431              		.loc 1 205 17 view .LVU114
 205:../BLDCMotor/motorctrl.c ****                 {
 432              		.loc 1 205 34 is_stmt 0 view .LVU115
 433 00d0 D4ED147A 		vldr.32	s15, [r4, #80]
 205:../BLDCMotor/motorctrl.c ****                 {
 434              		.loc 1 205 20 view .LVU116
 435 00d4 9FED227A 		vldr.32	s14, .L25+40
 436 00d8 F4EEC77A 		vcmpe.f32	s15, s14
 437 00dc F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 438 00e0 03DB     		blt	.L17
 207:../BLDCMotor/motorctrl.c ****                 }
 439              		.loc 1 207 21 is_stmt 1 view .LVU117
 207:../BLDCMotor/motorctrl.c ****                 }
 440              		.loc 1 207 50 is_stmt 0 view .LVU118
 441 00e2 77EEC77A 		vsub.f32	s15, s15, s14
 442 00e6 C4ED147A 		vstr.32	s15, [r4, #80]
 443              	.L17:
 210:../BLDCMotor/motorctrl.c ****                 dut01 = _svpwm(uab.alpha,uab.beta);
 444              		.loc 1 210 17 is_stmt 1 view .LVU119
 210:../BLDCMotor/motorctrl.c ****                 dut01 = _svpwm(uab.alpha,uab.beta);
 445              		.loc 1 210 23 is_stmt 0 view .LVU120
 446 00ea 164C     		ldr	r4, .L25+12
 447 00ec 069B     		ldr	r3, [sp, #24]
 448 00ee 0093     		str	r3, [sp]
 449 00f0 03AB     		add	r3, sp, #12
 450 00f2 0ECB     		ldm	r3, {r1, r2, r3}
 451 00f4 94ED140A 		vldr.32	s0, [r4, #80]
 452              	.LVL40:
 210:../BLDCMotor/motorctrl.c ****                 dut01 = _svpwm(uab.alpha,uab.beta);
 453              		.loc 1 210 23 view .LVU121
 454 00f8 07A8     		add	r0, sp, #28
 455 00fa FFF7FEFF 		bl	_2r_2s
 456              	.LVL41:
 210:../BLDCMotor/motorctrl.c ****                 dut01 = _svpwm(uab.alpha,uab.beta);
 457              		.loc 1 210 65 is_stmt 1 view .LVU122
 210:../BLDCMotor/motorctrl.c ****                 dut01 = _svpwm(uab.alpha,uab.beta);
 458              		.loc 1 210 90 is_stmt 0 view .LVU123
 459 00fe 226D     		ldr	r2, [r4, #80]	@ float
 210:../BLDCMotor/motorctrl.c ****                 dut01 = _svpwm(uab.alpha,uab.beta);
 460              		.loc 1 210 75 view .LVU124
 461 0100 184B     		ldr	r3, .L25+44
 462 0102 1A60     		str	r2, [r3]	@ float
 211:../BLDCMotor/motorctrl.c ****                 motor_set_pwm(dut01);
 463              		.loc 1 211 17 is_stmt 1 view .LVU125
 211:../BLDCMotor/motorctrl.c ****                 motor_set_pwm(dut01);
 464              		.loc 1 211 25 is_stmt 0 view .LVU126
 465 0104 DDED080A 		vldr.32	s1, [sp, #32]
 466 0108 9DED070A 		vldr.32	s0, [sp, #28]
 467 010c FFF7FEFF 		bl	_svpwm
 468              	.LVL42:
 469 0110 8DED110A 		vstr.32	s0, [sp, #68]
 470 0114 CDED120A 		vstr.32	s1, [sp, #72]
 471 0118 8DED131A 		vstr.32	s2, [sp, #76]
 212:../BLDCMotor/motorctrl.c ****                 sg_motordebug.self_ele_theta += 0.31415926f;
 472              		.loc 1 212 17 is_stmt 1 view .LVU127
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 17


 473 011c FFF7FEFF 		bl	motor_set_pwm
 474              	.LVL43:
 213:../BLDCMotor/motorctrl.c ****                 // sg_motordebug.self_ele_theta += 0.002f;
 475              		.loc 1 213 17 view .LVU128
 213:../BLDCMotor/motorctrl.c ****                 // sg_motordebug.self_ele_theta += 0.002f;
 476              		.loc 1 213 46 is_stmt 0 view .LVU129
 477 0120 D4ED147A 		vldr.32	s15, [r4, #80]
 478 0124 9FED107A 		vldr.32	s14, .L25+48
 479 0128 77EE877A 		vadd.f32	s15, s15, s14
 480 012c C4ED147A 		vstr.32	s15, [r4, #80]
 481              	.LBE3:
 230:../BLDCMotor/motorctrl.c **** }
 482              		.loc 1 230 5 is_stmt 1 view .LVU130
 231:../BLDCMotor/motorctrl.c **** void _limit_voltagecircle(uint32_t u_ref,uint32_t elec_theta)
 483              		.loc 1 231 1 is_stmt 0 view .LVU131
 484 0130 15B0     		add	sp, sp, #84
 485              	.LCFI12:
 486              		.cfi_def_cfa_offset 20
 487              		@ sp needed
 488 0132 BDEC028B 		vldm	sp!, {d8}
 489              	.LCFI13:
 490              		.cfi_restore 80
 491              		.cfi_restore 81
 492              		.cfi_def_cfa_offset 12
 493              	.LVL44:
 231:../BLDCMotor/motorctrl.c **** void _limit_voltagecircle(uint32_t u_ref,uint32_t elec_theta)
 494              		.loc 1 231 1 view .LVU132
 495 0136 30BD     		pop	{r4, r5, pc}
 496              	.L26:
 497              		.align	2
 498              	.L25:
 499 0138 00000000 		.word	.LANCHOR0
 500 013c F1197605 		.word	91625969
 501 0140 00000000 		.word	.LANCHOR1
 502 0144 00000000 		.word	.LANCHOR2
 503 0148 4260653B 		.word	996499522
 504 014c 6F12033B 		.word	990057071
 505 0150 00000000 		.word	.LANCHOR3
 506 0154 A69BC43A 		.word	985963430
 507 0158 00000000 		.word	.LANCHOR4
 508 015c 00000000 		.word	.LANCHOR5
 509 0160 DA0FC940 		.word	1086918618
 510 0164 00000000 		.word	.LANCHOR6
 511 0168 7CD9A03E 		.word	1050728828
 512              		.cfi_endproc
 513              	.LFE330:
 515              		.section	.text._limit_voltagecircle,"ax",%progbits
 516              		.align	1
 517              		.global	_limit_voltagecircle
 518              		.syntax unified
 519              		.thumb
 520              		.thumb_func
 522              	_limit_voltagecircle:
 523              	.LVL45:
 524              	.LFB331:
 233:../BLDCMotor/motorctrl.c ****     uint32_t u_alpha,u_beta;
 525              		.loc 1 233 1 is_stmt 1 view -0
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 18


 526              		.cfi_startproc
 527              		@ args = 0, pretend = 0, frame = 0
 528              		@ frame_needed = 0, uses_anonymous_args = 0
 529              		@ link register save eliminated.
 234:../BLDCMotor/motorctrl.c ****     u_alpha = u_ref * cosf(elec_theta);
 530              		.loc 1 234 5 view .LVU134
 235:../BLDCMotor/motorctrl.c ****     u_beta = u_ref * sinf(elec_theta);
 531              		.loc 1 235 5 view .LVU135
 236:../BLDCMotor/motorctrl.c **** }
 532              		.loc 1 236 5 view .LVU136
 237:../BLDCMotor/motorctrl.c **** dq_t _currmentloop(abc_t i_abc,float ele_theta)
 533              		.loc 1 237 1 is_stmt 0 view .LVU137
 534 0000 7047     		bx	lr
 535              		.cfi_endproc
 536              	.LFE331:
 538              		.section	.text.foc_paraminit,"ax",%progbits
 539              		.align	1
 540              		.global	foc_paraminit
 541              		.syntax unified
 542              		.thumb
 543              		.thumb_func
 545              	foc_paraminit:
 546              	.LFB338:
 359:../BLDCMotor/motorctrl.c **** 
 360:../BLDCMotor/motorctrl.c **** void foc_paraminit(void)
 361:../BLDCMotor/motorctrl.c **** {
 547              		.loc 1 361 1 is_stmt 1 view -0
 548              		.cfi_startproc
 549              		@ args = 0, pretend = 0, frame = 0
 550              		@ frame_needed = 0, uses_anonymous_args = 0
 551 0000 10B5     		push	{r4, lr}
 552              	.LCFI14:
 553              		.cfi_def_cfa_offset 8
 554              		.cfi_offset 4, -8
 555              		.cfi_offset 14, -4
 556 0002 2DED028B 		vpush.64	{d8}
 557              	.LCFI15:
 558              		.cfi_def_cfa_offset 16
 559              		.cfi_offset 80, -16
 560              		.cfi_offset 81, -12
 362:../BLDCMotor/motorctrl.c ****     sgp_curloop_d_pid = &sg_curloop_param.d_pid;
 561              		.loc 1 362 5 view .LVU139
 562              		.loc 1 362 23 is_stmt 0 view .LVU140
 563 0006 1D48     		ldr	r0, .L30
 564 0008 1D4B     		ldr	r3, .L30+4
 565 000a 1860     		str	r0, [r3]
 363:../BLDCMotor/motorctrl.c ****     sgp_curloop_q_pid = &sg_curloop_param.q_pid;
 566              		.loc 1 363 5 is_stmt 1 view .LVU141
 567              		.loc 1 363 23 is_stmt 0 view .LVU142
 568 000c 1D4C     		ldr	r4, .L30+8
 569 000e 00F11C03 		add	r3, r0, #28
 570 0012 2360     		str	r3, [r4]
 364:../BLDCMotor/motorctrl.c ****     pid_init(sgp_curloop_d_pid,0.4f,0.000f,1.0f,D_MAX_VAL,D_MIN_VAL);
 571              		.loc 1 364 5 is_stmt 1 view .LVU143
 572 0014 DFED1C8A 		vldr.32	s17, .L30+12
 573 0018 9FED1C8A 		vldr.32	s16, .L30+16
 574 001c B0EE682A 		vmov.f32	s4, s17
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 19


 575 0020 F0EE481A 		vmov.f32	s3, s16
 576 0024 B7EE001A 		vmov.f32	s2, #1.0e+0
 577 0028 DFED190A 		vldr.32	s1, .L30+20
 578 002c 9FED190A 		vldr.32	s0, .L30+24
 579 0030 FFF7FEFF 		bl	pid_init
 580              	.LVL46:
 365:../BLDCMotor/motorctrl.c ****     pid_init(sgp_curloop_q_pid,0.020f,0.001f,1.0f,D_MAX_VAL,D_MIN_VAL);
 581              		.loc 1 365 5 view .LVU144
 582 0034 B0EE682A 		vmov.f32	s4, s17
 583 0038 F0EE481A 		vmov.f32	s3, s16
 584 003c B7EE001A 		vmov.f32	s2, #1.0e+0
 585 0040 DFED150A 		vldr.32	s1, .L30+28
 586 0044 9FED150A 		vldr.32	s0, .L30+32
 587 0048 2068     		ldr	r0, [r4]
 588 004a FFF7FEFF 		bl	pid_init
 589              	.LVL47:
 366:../BLDCMotor/motorctrl.c ****     lowfilter_init(&sg_elefilter[0],80);
 590              		.loc 1 366 5 view .LVU145
 591 004e 9FED148A 		vldr.32	s16, .L30+36
 592 0052 144C     		ldr	r4, .L30+40
 593 0054 B0EE480A 		vmov.f32	s0, s16
 594 0058 2046     		mov	r0, r4
 595 005a FFF7FEFF 		bl	lowfilter_init
 596              	.LVL48:
 367:../BLDCMotor/motorctrl.c ****     lowfilter_init(&sg_elefilter[1],80);
 597              		.loc 1 367 5 view .LVU146
 598 005e B0EE480A 		vmov.f32	s0, s16
 599 0062 04F10800 		add	r0, r4, #8
 600 0066 FFF7FEFF 		bl	lowfilter_init
 601              	.LVL49:
 368:../BLDCMotor/motorctrl.c ****     lowfilter_init(&sg_elefilter[2],80);
 602              		.loc 1 368 5 view .LVU147
 603 006a B0EE480A 		vmov.f32	s0, s16
 604 006e 04F11000 		add	r0, r4, #16
 605 0072 FFF7FEFF 		bl	lowfilter_init
 606              	.LVL50:
 369:../BLDCMotor/motorctrl.c **** }...
 607              		.loc 1 369 1 is_stmt 0 view .LVU148
 608 0076 BDEC028B 		vldm	sp!, {d8}
 609              	.LCFI16:
 610              		.cfi_restore 80
 611              		.cfi_restore 81
 612              		.cfi_def_cfa_offset 8
 613 007a 10BD     		pop	{r4, pc}
 614              	.L31:
 615              		.align	2
 616              	.L30:
 617 007c 00000000 		.word	.LANCHOR8
 618 0080 00000000 		.word	.LANCHOR7
 619 0084 00000000 		.word	.LANCHOR9
 620 0088 333373C1 		.word	-1049414861
 621 008c 33337341 		.word	1098068787
 622 0090 00000000 		.word	0
 623 0094 CDCCCC3E 		.word	1053609165
 624 0098 6F12833A 		.word	981668463
 625 009c 0AD7A33C 		.word	1017370378
 626 00a0 0000A042 		.word	1117782016
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 20


 627 00a4 00000000 		.word	.LANCHOR3
 628              		.cfi_endproc
 629              	.LFE338:
 631              		.section	.rodata.motortctrl_process.str1.4,"aMS",%progbits,1
 632              		.align	2
 633              	.LC1:
 634 0000 6D6F746F 		.ascii	"motor init\015\012\000"
 634      7220696E 
 634      69740D0A 
 634      00
 635              		.section	.text.motortctrl_process,"ax",%progbits
 636              		.align	1
 637              		.global	motortctrl_process
 638              		.syntax unified
 639              		.thumb
 640              		.thumb_func
 642              	motortctrl_process:
 643              	.LFB329:
  78:../BLDCMotor/motorctrl.c **** {
 644              		.loc 1 78 1 is_stmt 1 view -0
 645              		.cfi_startproc
 646              		@ args = 0, pretend = 0, frame = 0
 647              		@ frame_needed = 0, uses_anonymous_args = 0
 648 0000 08B5     		push	{r3, lr}
 649              	.LCFI17:
 650              		.cfi_def_cfa_offset 8
 651              		.cfi_offset 3, -8
 652              		.cfi_offset 14, -4
  79:../BLDCMotor/motorctrl.c ****     switch (g_Motor1.state)
 653              		.loc 1 79 5 view .LVU150
  79:../BLDCMotor/motorctrl.c ****     switch (g_Motor1.state)
 654              		.loc 1 79 21 is_stmt 0 view .LVU151
 655 0002 194B     		ldr	r3, .L38
 656 0004 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
  79:../BLDCMotor/motorctrl.c ****     switch (g_Motor1.state)
 657              		.loc 1 79 5 view .LVU152
 658 0006 032B     		cmp	r3, #3
 659 0008 17D0     		beq	.L33
 660 000a 042B     		cmp	r3, #4
 661 000c 29D0     		beq	.L34
 662 000e 03B1     		cbz	r3, .L37
 663              	.L32:
 106:../BLDCMotor/motorctrl.c **** }
 664              		.loc 1 106 1 view .LVU153
 665 0010 08BD     		pop	{r3, pc}
 666              	.L37:
  82:../BLDCMotor/motorctrl.c ****         sg_MecThetaOffset = _get_angleoffset();
 667              		.loc 1 82 9 is_stmt 1 view .LVU154
  82:../BLDCMotor/motorctrl.c ****         sg_MecThetaOffset = _get_angleoffset();
 668              		.loc 1 82 29 is_stmt 0 view .LVU155
 669 0012 FFF7FEFF 		bl	_get_angleoffset
 670              	.LVL51:
  82:../BLDCMotor/motorctrl.c ****         sg_MecThetaOffset = _get_angleoffset();
 671              		.loc 1 82 27 view .LVU156
 672 0016 154B     		ldr	r3, .L38+4
 673 0018 83ED000A 		vstr.32	s0, [r3]
  83:../BLDCMotor/motorctrl.c ****         foc_paraminit();
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 21


 674              		.loc 1 83 9 is_stmt 1 view .LVU157
 675 001c FFF7FEFF 		bl	foc_paraminit
 676              	.LVL52:
  84:../BLDCMotor/motorctrl.c ****         USER_DEBUG_NORMAL("motor init\r\n");
 677              		.loc 1 84 9 view .LVU158
 678 0020 1349     		ldr	r1, .L38+8
 679 0022 0020     		movs	r0, #0
 680 0024 FFF7FEFF 		bl	SEGGER_RTT_printf
 681              	.LVL53:
  85:../BLDCMotor/motorctrl.c ****         HAL_Delay(20);
 682              		.loc 1 85 9 view .LVU159
 683 0028 1420     		movs	r0, #20
 684 002a FFF7FEFF 		bl	HAL_Delay
 685              	.LVL54:
  86:../BLDCMotor/motorctrl.c ****         motor_enable();
 686              		.loc 1 86 9 view .LVU160
 687 002e FFF7FEFF 		bl	motor_enable
 688              	.LVL55:
  87:../BLDCMotor/motorctrl.c ****         g_Motor1.state = MOTOR_RUNING;           
 689              		.loc 1 87 9 view .LVU161
  87:../BLDCMotor/motorctrl.c ****         g_Motor1.state = MOTOR_RUNING;           
 690              		.loc 1 87 24 is_stmt 0 view .LVU162
 691 0032 0D4B     		ldr	r3, .L38
 692 0034 0322     		movs	r2, #3
 693 0036 1A70     		strb	r2, [r3]
  88:../BLDCMotor/motorctrl.c ****         break;
 694              		.loc 1 88 9 is_stmt 1 view .LVU163
 695 0038 EAE7     		b	.L32
 696              	.L33:
  92:../BLDCMotor/motorctrl.c ****             if (!(++g_Motor1.cnt % 15000))
 697              		.loc 1 92 13 view .LVU164
  92:../BLDCMotor/motorctrl.c ****             if (!(++g_Motor1.cnt % 15000))
 698              		.loc 1 92 29 is_stmt 0 view .LVU165
 699 003a 0B4A     		ldr	r2, .L38
 700 003c 5388     		ldrh	r3, [r2, #2]
  92:../BLDCMotor/motorctrl.c ****             if (!(++g_Motor1.cnt % 15000))
 701              		.loc 1 92 19 view .LVU166
 702 003e 0133     		adds	r3, r3, #1
 703 0040 9BB2     		uxth	r3, r3
  92:../BLDCMotor/motorctrl.c ****             if (!(++g_Motor1.cnt % 15000))
 704              		.loc 1 92 16 view .LVU167
 705 0042 5380     		strh	r3, [r2, #2]	@ movhi
  92:../BLDCMotor/motorctrl.c ****             if (!(++g_Motor1.cnt % 15000))
 706              		.loc 1 92 17 view .LVU168
 707 0044 0B4A     		ldr	r2, .L38+12
 708 0046 A2FB0312 		umull	r1, r2, r2, r3
 709 004a 120B     		lsrs	r2, r2, #12
 710 004c 43F69821 		movw	r1, #15000
 711 0050 01FB1233 		mls	r3, r1, r2, r3
 712 0054 9BB2     		uxth	r3, r3
  92:../BLDCMotor/motorctrl.c ****             if (!(++g_Motor1.cnt % 15000))
 713              		.loc 1 92 16 view .LVU169
 714 0056 002B     		cmp	r3, #0
 715 0058 DAD1     		bne	.L32
  95:../BLDCMotor/motorctrl.c ****                 g_Motor1.state = MOTOR_STOP;
 716              		.loc 1 95 17 is_stmt 1 view .LVU170
  95:../BLDCMotor/motorctrl.c ****                 g_Motor1.state = MOTOR_STOP;
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 22


 717              		.loc 1 95 32 is_stmt 0 view .LVU171
 718 005a 034B     		ldr	r3, .L38
 719 005c 0422     		movs	r2, #4
 720 005e 1A70     		strb	r2, [r3]
 721 0060 D6E7     		b	.L32
 722              	.L34:
 101:../BLDCMotor/motorctrl.c ****         motor_disable();
 723              		.loc 1 101 9 is_stmt 1 view .LVU172
 724 0062 FFF7FEFF 		bl	motor_disable
 725              	.LVL56:
 102:../BLDCMotor/motorctrl.c ****         break;
 726              		.loc 1 102 9 view .LVU173
 106:../BLDCMotor/motorctrl.c **** }
 727              		.loc 1 106 1 is_stmt 0 view .LVU174
 728 0066 D3E7     		b	.L32
 729              	.L39:
 730              		.align	2
 731              	.L38:
 732 0068 00000000 		.word	.LANCHOR10
 733 006c 00000000 		.word	.LANCHOR4
 734 0070 00000000 		.word	.LC1
 735 0074 73B2E745 		.word	1172812403
 736              		.cfi_endproc
 737              	.LFE329:
 739              		.global	cur_angle
 740              		.global	test_val
 741              		.global	test_ic
 742              		.global	test_ib
 743              		.global	test_ia
 744              		.global	raw_angle
 745              		.global	next_angle_test
 746              		.global	pre_angle_test
 747              		.global	g_Motor1
 748              		.global	sg_motordebug
 749              		.section	.rodata
 750              		.align	2
 751              		.set	.LANCHOR5,. + 0
 752              	.LC0:
 753 0000 00000000 		.word	0
 754 0004 0000803F 		.word	1065353216
 755 0008 00000000 		.word	0
 756 000c 66660000 		.word	26214
 757              		.section	.bss.cnt.0,"aw",%nobits
 758              		.align	2
 759              		.set	.LANCHOR0,. + 0
 762              	cnt.0:
 763 0000 00000000 		.space	4
 764              		.section	.bss.cur_angle,"aw",%nobits
 765              		.align	2
 766              		.set	.LANCHOR6,. + 0
 769              	cur_angle:
 770 0000 00000000 		.space	4
 771              		.section	.bss.g_Motor1,"aw",%nobits
 772              		.align	2
 773              		.set	.LANCHOR10,. + 0
 776              	g_Motor1:
 777 0000 00000000 		.space	4
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 23


 778              		.section	.bss.next_angle_test,"aw",%nobits
 779              		.align	2
 782              	next_angle_test:
 783 0000 00000000 		.space	4
 784              		.section	.bss.pre_angle_test,"aw",%nobits
 785              		.align	2
 788              	pre_angle_test:
 789 0000 00000000 		.space	4
 790              		.section	.bss.raw_angle,"aw",%nobits
 791              		.align	2
 794              	raw_angle:
 795 0000 00000000 		.space	4
 796              		.section	.bss.sg_MecThetaOffset,"aw",%nobits
 797              		.align	2
 798              		.set	.LANCHOR4,. + 0
 801              	sg_MecThetaOffset:
 802 0000 00000000 		.space	4
 803              		.section	.bss.sg_curloop_param,"aw",%nobits
 804              		.align	2
 805              		.set	.LANCHOR8,. + 0
 808              	sg_curloop_param:
 809 0000 00000000 		.space	56
 809      00000000 
 809      00000000 
 809      00000000 
 809      00000000 
 810              		.section	.bss.sg_elefilter,"aw",%nobits
 811              		.align	2
 812              		.set	.LANCHOR3,. + 0
 815              	sg_elefilter:
 816 0000 00000000 		.space	24
 816      00000000 
 816      00000000 
 816      00000000 
 816      00000000 
 817              		.section	.bss.sg_motordebug,"aw",%nobits
 818              		.align	2
 819              		.set	.LANCHOR2,. + 0
 822              	sg_motordebug:
 823 0000 00000000 		.space	92
 823      00000000 
 823      00000000 
 823      00000000 
 823      00000000 
 824              		.section	.bss.sgp_curloop_d_pid,"aw",%nobits
 825              		.align	2
 826              		.set	.LANCHOR7,. + 0
 829              	sgp_curloop_d_pid:
 830 0000 00000000 		.space	4
 831              		.section	.bss.sgp_curloop_q_pid,"aw",%nobits
 832              		.align	2
 833              		.set	.LANCHOR9,. + 0
 836              	sgp_curloop_q_pid:
 837 0000 00000000 		.space	4
 838              		.section	.bss.test_ia,"aw",%nobits
 839              		.align	2
 842              	test_ia:
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 24


 843 0000 00000000 		.space	4
 844              		.section	.bss.test_ib,"aw",%nobits
 845              		.align	2
 848              	test_ib:
 849 0000 00000000 		.space	4
 850              		.section	.bss.test_ic,"aw",%nobits
 851              		.align	2
 854              	test_ic:
 855 0000 00000000 		.space	4
 856              		.section	.bss.test_val,"aw",%nobits
 857              		.align	2
 858              		.set	.LANCHOR1,. + 0
 861              	test_val:
 862 0000 00000000 		.space	4
 863              		.text
 864              	.Letext0:
 865              		.file 2 "d:\\program files\\gcc-arm-none-eabi-10.3-2021.10\\arm-none-eabi\\include\\machine\\_defa
 866              		.file 3 "d:\\program files\\gcc-arm-none-eabi-10.3-2021.10\\arm-none-eabi\\include\\sys\\_stdint.h
 867              		.file 4 "../Common/IQMath/ti/IQmathLib.h"
 868              		.file 5 "../Common/method/filter.h"
 869              		.file 6 "../Common/method/pid.h"
 870              		.file 7 "../BLDCMotor/motorctrl_common.h"
 871              		.file 8 "./Board/board.h"
 872              		.file 9 "../Sensor/sensor.h"
 873              		.file 10 "Drivers/STM32G4xx_HAL_Driver/Inc/stm32g4xx_hal.h"
 874              		.file 11 "Inc/tim.h"
 875              		.file 12 "Inc/adc.h"
 876              		.file 13 "../Common/debuglog/SEGGER_RTT_V792h/RTT/SEGGER_RTT.h"
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 25


DEFINED SYMBOLS
                            *ABS*:00000000 motorctrl.c
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:20     .text.motor_enable_noirq:00000000 $t
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:25     .text.motor_enable_noirq:00000000 motor_enable_noirq
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:46     .text.motor_set_pwm:00000000 $t
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:51     .text.motor_set_pwm:00000000 motor_set_pwm
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:80     .text.motor_enable:00000000 $t
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:85     .text.motor_enable:00000000 motor_enable
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:111    .text.motor_disable:00000000 $t
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:116    .text.motor_disable:00000000 motor_disable
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:139    .text._get_angleoffset:00000000 $t
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:144    .text._get_angleoffset:00000000 _get_angleoffset
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:251    .text._get_angleoffset:0000006c $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:257    .text._50uscycle_process:00000000 $t
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:263    .text._50uscycle_process:00000000 _50uscycle_process
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:499    .text._50uscycle_process:00000138 $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:516    .text._limit_voltagecircle:00000000 $t
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:522    .text._limit_voltagecircle:00000000 _limit_voltagecircle
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:539    .text.foc_paraminit:00000000 $t
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:545    .text.foc_paraminit:00000000 foc_paraminit
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:617    .text.foc_paraminit:0000007c $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:632    .rodata.motortctrl_process.str1.4:00000000 $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:636    .text.motortctrl_process:00000000 $t
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:642    .text.motortctrl_process:00000000 motortctrl_process
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:732    .text.motortctrl_process:00000068 $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:769    .bss.cur_angle:00000000 cur_angle
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:861    .bss.test_val:00000000 test_val
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:854    .bss.test_ic:00000000 test_ic
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:848    .bss.test_ib:00000000 test_ib
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:842    .bss.test_ia:00000000 test_ia
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:794    .bss.raw_angle:00000000 raw_angle
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:782    .bss.next_angle_test:00000000 next_angle_test
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:788    .bss.pre_angle_test:00000000 pre_angle_test
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:776    .bss.g_Motor1:00000000 g_Motor1
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:822    .bss.sg_motordebug:00000000 sg_motordebug
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:750    .rodata:00000000 $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:758    .bss.cnt.0:00000000 $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:762    .bss.cnt.0:00000000 cnt.0
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:765    .bss.cur_angle:00000000 $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:772    .bss.g_Motor1:00000000 $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:779    .bss.next_angle_test:00000000 $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:785    .bss.pre_angle_test:00000000 $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:791    .bss.raw_angle:00000000 $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:797    .bss.sg_MecThetaOffset:00000000 $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:801    .bss.sg_MecThetaOffset:00000000 sg_MecThetaOffset
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:804    .bss.sg_curloop_param:00000000 $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:808    .bss.sg_curloop_param:00000000 sg_curloop_param
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:811    .bss.sg_elefilter:00000000 $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:815    .bss.sg_elefilter:00000000 sg_elefilter
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:818    .bss.sg_motordebug:00000000 $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:825    .bss.sgp_curloop_d_pid:00000000 $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:829    .bss.sgp_curloop_d_pid:00000000 sgp_curloop_d_pid
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:832    .bss.sgp_curloop_q_pid:00000000 $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:836    .bss.sgp_curloop_q_pid:00000000 sgp_curloop_q_pid
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:839    .bss.test_ia:00000000 $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:845    .bss.test_ib:00000000 $d
C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:851    .bss.test_ic:00000000 $d
ARM GAS  C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s 			page 26


C:\Users\57308\AppData\Local\Temp\ccBBzBcu.s:857    .bss.test_val:00000000 $d

UNDEFINED SYMBOLS
tim_pwm_enable
tim_set_pwm
tim_tigger_adc
adc_start
tim_pwm_disable
adc_stop
_svpwm
HAL_Delay
sensor_user_read
_IQ15toF
lowfilter_cale
_normalize_angle
_2r_2s
pid_init
lowfilter_init
SEGGER_RTT_printf
